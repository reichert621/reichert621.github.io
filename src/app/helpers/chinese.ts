// Most of this was just copied from https://chinese.yabla.com/chinese-pinyin-chart.php
// ¯\_(ツ)_/¯

const TONES: { [key: string]: { [tone: string]: string } } = {
  a: { 1: 'ā', 2: 'á', 3: 'ǎ', 4: 'à', 5: 'a' },
  o: { 1: 'ō', 2: 'ó', 3: 'ǒ', 4: 'ò', 5: 'o' },
  e: { 1: 'ē', 2: 'é', 3: 'ě', 4: 'è', 5: 'e' },
  i: { 1: 'ī', 2: 'í', 3: 'ǐ', 4: 'ì', 5: 'i' },
  u: { 1: 'ū', 2: 'ú', 3: 'ǔ', 4: 'ù', 5: 'u' },
  ü: { 1: 'ǖ', 2: 'ǘ', 3: 'ǚ', 4: 'ǜ', 5: 'ü' },
  A: { 1: 'Ā', 2: 'Á', 3: 'Ǎ', 4: 'À', 5: 'A' },
  O: { 1: 'Ō', 2: 'Ó', 3: 'Ǒ', 4: 'Ò', 5: 'O' },
  E: { 1: 'Ē', 2: 'É', 3: 'Ě', 4: 'È', 5: 'E' },
  I: { 1: 'Ī', 2: 'Í', 3: 'Ǐ', 4: 'Ì', 5: 'I' },
  U: { 1: 'Ū', 2: 'Ú', 3: 'Ǔ', 4: 'Ù', 5: 'U' },
  Ü: { 1: 'Ǖ', 2: 'Ǘ', 3: 'Ǚ', 4: 'Ǜ', 5: 'Ü' }
};

function isVowel(char: string) {
  return 'āáǎàaōóǒòoēéěèeīíǐìiūúǔùuǖǘǚǜüv'.indexOf(char.toLowerCase()) !== -1;
}

function removeAccents(str: string) {
  return str
    .replace(/[āáǎàa]/g, 'a')
    .replace(/[ĀÁǍÀA]/g, 'A')
    .replace(/[ōóǒòo]/g, 'o')
    .replace(/[ŌÓǑÒO]/g, 'O')
    .replace(/[ēéěèe]/g, 'e')
    .replace(/[ĒÉĚÈE]/g, 'E')
    .replace(/[īīíǐìi]/gi, 'i')
    .replace(/[ūúǔùu]/gi, 'u')
    .replace(/[ǖǘǚǜüv]/gi, 'ü');
}

export function applyAccents(text: string, tone: number, position?: number) {
  let pos = position || text.length;
  let start;
  let end;
  let hasFoundVowel = false;

  while (pos >= 1) {
    let c = text.substr(pos - 1, 1);
    if (!hasFoundVowel && isVowel(c)) {
      end = pos;
      hasFoundVowel = true;
    }
    if (!hasFoundVowel && c.match(/\s/)) {
      return;
    }
    if (hasFoundVowel && !isVowel(c)) {
      start = pos;
      break;
    }
    if (hasFoundVowel && pos === 1 && isVowel(c)) {
      start = 0;
      break;
    }
    pos--;
  }

  let vowels = removeAccents(text.substr(start, end - start));

  if (!vowels.length) return;

  if (vowels.toLowerCase().indexOf('a') !== -1) {
    vowels = vowels
      .replace('a', TONES['a'][tone])
      .replace('A', TONES['A'][tone]);
  } else if (vowels.toLowerCase().indexOf('e') !== -1) {
    vowels = vowels
      .replace('e', TONES['e'][tone])
      .replace('E', TONES['E'][tone]);
  } else if (vowels.toLowerCase() === 'ou') {
    vowels = vowels
      .replace('o', TONES['o'][tone])
      .replace('O', TONES['O'][tone]);
  } else {
    let last = vowels.substr(vowels.length - 1, 1);
    if (last) {
      vowels = vowels.replace(last, TONES[last][tone]);
    }
  }
  return text.substr(0, start) + vowels + text.substr(end);
}

export const pinyin = [
  'a',
  'o',
  'e',
  'er',
  'ai',
  'ao',
  'ou',
  'an',
  'en',
  'ang',
  'eng',
  'yi',
  'ya',
  'yao',
  'ye',
  'you',
  'yan',
  'yin',
  'yang',
  'ying',
  'yong',
  'wu',
  'wa',
  'wo',
  'wai',
  'wei',
  'wan',
  'wen',
  'wang',
  'weng',
  'yu',
  'yue',
  'yuan',
  'yun',
  'ba',
  'bo',
  'bai',
  'bei',
  'bao',
  'ban',
  'ben',
  'bang',
  'beng',
  'bi',
  'biao',
  'bie',
  'bian',
  'bin',
  'bing',
  'bu',
  'pa',
  'po',
  'pai',
  'pei',
  'pao',
  'pou',
  'pan',
  'pen',
  'pang',
  'peng',
  'pi',
  'piao',
  'pie',
  'pian',
  'pin',
  'ping',
  'pu',
  'ma',
  'mo',
  'me',
  'mai',
  'mei',
  'mao',
  'mou',
  'man',
  'men',
  'mang',
  'meng',
  'mi',
  'miao',
  'mie',
  'miu',
  'mian',
  'min',
  'ming',
  'mu',
  'fa',
  'fo',
  'fei',
  'fou',
  'fan',
  'fen',
  'fang',
  'feng',
  'fu',
  'da',
  'de',
  'dai',
  'dei',
  'dao',
  'dou',
  'dan',
  'den',
  'dang',
  'deng',
  'dong',
  'di',
  'diao',
  'die',
  'diu',
  'dian',
  'ding',
  'du',
  'duo',
  'dui',
  'duan',
  'dun',
  'ta',
  'te',
  'tai',
  'tei',
  'tao',
  'tou',
  'tan',
  'tang',
  'teng',
  'tong',
  'ti',
  'tiao',
  'tie',
  'tian',
  'ting',
  'tu',
  'tuo',
  'tui',
  'tuan',
  'tun',
  'na',
  'ne',
  'nai',
  'nei',
  'nao',
  'nou',
  'nan',
  'nen',
  'nang',
  'neng',
  'nong',
  'ni',
  'niao',
  'nie',
  'niu',
  'nian',
  'nin',
  'niang',
  'ning',
  'nu',
  'nuo',
  'nuan',
  'nü',
  'nüe',
  'la',
  'le',
  'lai',
  'lei',
  'lao',
  'lou',
  'lan',
  'lang',
  'leng',
  'long',
  'li',
  'lia',
  'liao',
  'lie',
  'liu',
  'lian',
  'lin',
  'liang',
  'ling',
  'lu',
  'luo',
  'luan',
  'lun',
  'lü',
  'lüe',
  'ga',
  'ge',
  'gai',
  'gei',
  'gao',
  'gou',
  'gan',
  'gen',
  'gang',
  'geng',
  'gong',
  'gu',
  'gua',
  'guo',
  'guai',
  'gui',
  'guan',
  'gun',
  'guang',
  'ka',
  'ke',
  'kai',
  'kei',
  'kao',
  'kou',
  'kan',
  'ken',
  'kang',
  'keng',
  'kong',
  'ku',
  'kua',
  'kuo',
  'kuai',
  'kui',
  'kuan',
  'kun',
  'kuang',
  'ha',
  'he',
  'hai',
  'hei',
  'hao',
  'hou',
  'han',
  'hen',
  'hang',
  'heng',
  'hong',
  'hu',
  'hua',
  'huo',
  'huai',
  'hui',
  'huan',
  'hun',
  'huang',
  'za',
  'ze',
  'zi',
  'zai',
  'zei',
  'zao',
  'zou',
  'zan',
  'zen',
  'zang',
  'zeng',
  'zong',
  'zu',
  'zuo',
  'zui',
  'zuan',
  'zun',
  'ca',
  'ce',
  'ci',
  'cai',
  'cao',
  'cou',
  'can',
  'cen',
  'cang',
  'ceng',
  'cong',
  'cu',
  'cuo',
  'cui',
  'cuan',
  'cun',
  'sa',
  'se',
  'si',
  'sai',
  'sao',
  'sou',
  'san',
  'sen',
  'sang',
  'seng',
  'song',
  'su',
  'suo',
  'sui',
  'suan',
  'sun',
  'zha',
  'zhe',
  'zhi',
  'zhai',
  'zhei',
  'zhao',
  'zhou',
  'zhan',
  'zhen',
  'zhang',
  'zheng',
  'zhong',
  'zhu',
  'zhua',
  'zhuo',
  'zhuai',
  'zhui',
  'zhuan',
  'zhun',
  'zhuang',
  'cha',
  'che',
  'chi',
  'chai',
  'chao',
  'chou',
  'chan',
  'chen',
  'chang',
  'cheng',
  'chong',
  'chu',
  'chua',
  'chuo',
  'chuai',
  'chui',
  'chuan',
  'chun',
  'chuang',
  'sha',
  'she',
  'shi',
  'shai',
  'shei',
  'shao',
  'shou',
  'shan',
  'shen',
  'shang',
  'sheng',
  'shu',
  'shua',
  'shuo',
  'shuai',
  'shui',
  'shuan',
  'shun',
  'shuang',
  're',
  'ri',
  'rao',
  'rou',
  'ran',
  'ren',
  'rang',
  'reng',
  'rong',
  'ru',
  'rua',
  'ruo',
  'rui',
  'ruan',
  'run',
  'ji',
  'jia',
  'jiao',
  'jie',
  'jiu',
  'jian',
  'jin',
  'jiang',
  'jing',
  'jiong',
  'ju',
  'jue',
  'juan',
  'jun',
  'qi',
  'qia',
  'qiao',
  'qie',
  'qiu',
  'qian',
  'qin',
  'qiang',
  'qing',
  'qiong',
  'qu',
  'que',
  'quan',
  'qun',
  'xi',
  'xia',
  'xiao',
  'xie',
  'xiu',
  'xian',
  'xin',
  'xiang',
  'xing',
  'xiong',
  'xu',
  'xue',
  'xuan',
  'xun'
];
